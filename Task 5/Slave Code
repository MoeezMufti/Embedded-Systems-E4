// SLAVE (Bottom Arduino)

const int slaveGreen  = 2;
const int slaveYellow = 3;  // unused in this simple mapping
const int slaveRed    = 4;

void setSlaveForState(const String& state) {
  if (state == "STATE_GREEN" || state == "STATE_YELLOW") {
    // Master cars moving then pedestrian red then slave red
    digitalWrite(slaveRed, HIGH);
    digitalWrite(slaveGreen, LOW);
    digitalWrite(slaveYellow, LOW);
  } 
  else if (state == "STATE_RED") {
    // Master cars stopped then pedestrian green then slave green
    digitalWrite(slaveRed, LOW);
    digitalWrite(slaveGreen, HIGH);
    digitalWrite(slaveYellow, LOW);
  }
}

void setup() {
  pinMode(slaveGreen, OUTPUT);
  pinMode(slaveYellow, OUTPUT);
  pinMode(slaveRed, OUTPUT);

  Serial.begin(9600);

  // Default: assume master starts in GREEN then slave must be RED
  digitalWrite(slaveRed, HIGH);
  digitalWrite(slaveGreen, LOW);
  digitalWrite(slaveYellow, LOW);
}

void loop() {
  if (Serial.available() > 0) {
    String msg = Serial.readStringUntil('\n');
    msg.trim(); // remove \r, spaces

    if (msg == "STATE_GREEN" || msg == "STATE_YELLOW" || msg == "STATE_RED") {
      setSlaveForState(msg);
    }
  }
}
